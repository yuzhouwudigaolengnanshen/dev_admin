
<div class="layui-content" id="project">
    <input type="hidden" id="formProjectId">
    <button id="createProjectButton" class="layui-btn layui-btn-normal">创建项目</button>

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>我创建的</legend>
    </fieldset>

    <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15" id="MyProjectList">

            <!--<div class="layui-col-md4" style="font-weight:bold;">-->
                <!--<div class="layui-card" style="background: url('../../../../../../../../image/bg-1.jpg');">-->
                    <!--<div class="layui-card-header">项目1</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--卡片式面板面板通常用于非白色背景色的主体内<br>-->
                        <!--从而映衬出边框投影-->
                    <!--</div>-->
                <!--</div>-->
                <!--<button class="layui-btn layui-btn-primary layui-btn-xs">编辑</button>-->
                <!--<button class="layui-btn layui-btn-danger layui-btn-xs">删除</button>-->
                <!--<button class="layui-btn layui-btn-success layui-btn-xs">成员设置</button>-->
            <!--</div>-->

            <!--<div class="layui-col-md4">-->
                <!--<div class="layui-card" style="background: url('../../../../../../../../image/bg-2.jpg');">-->
                    <!--<div class="layui-card-header">项目2</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--结合 layui 的栅格系统<br>-->
                        <!--轻松实现响应式布局-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="layui-col-md4">-->
                <!--<div class="layui-card" style="background: url('../../../../../../../../image/bg-3.jpg');">-->
                    <!--<div class="layui-card-header">项目3</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--结合 layui 的栅格系统<br>-->
                        <!--轻松实现响应式布局-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

        </div>
    </div>


    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>我加入的</legend>
    </fieldset>

    <div style="padding: 20px; background-color: #F2F2F2;">
        <div id="MyOwnProjectList" class="layui-row layui-col-space15">

            <!--<div class="layui-col-md4">-->
                <!--<div class="layui-card">-->
                    <!--<div class="layui-card-header">项目1</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--卡片式面板面板通常用于非白色背景色的主体内<br>-->
                        <!--从而映衬出边框投影-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="layui-col-md4">-->
                <!--<div class="layui-card">-->
                    <!--<div class="layui-card-header">项目2</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--结合 layui 的栅格系统<br>-->
                        <!--轻松实现响应式布局-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="layui-col-md4">-->
                <!--<div class="layui-card">-->
                    <!--<div class="layui-card-header">项目3</div>-->
                    <!--<div class="layui-card-body">-->
                        <!--结合 layui 的栅格系统<br>-->
                        <!--轻松实现响应式布局-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

        </div>
    </div>
</div>

<div class="layui-content" id="detail">
    <!--项目ID隐藏-->
    <input type="hidden" id="projectId">
    <button id="backProjectButton" class="layui-btn layui-btn-normal layui-btn-xs">返回</button>
    <div id="detailBody">
        <div class="layui-tab layui-tab-card" lay-filter="detail">
            <ul class="layui-tab-title">
                <li class="layui-this">任务管理</li>
                <li>BUG管理</li>
            </ul>
            <div class="layui-tab-content" style="position: static;">
                <div id="taskContent" class="layui-tab-item layui-show">内容1</div>
                <div id="bugContent" class="layui-tab-item">内容2</div>
            </div>
        </div>
    </div>
</div>

<!--<script type="text/html" id="userTableBar">-->
    <!--<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="assignRole">分配角色</a>-->
    <!--<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>-->
    <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
<!--</script>-->

<script type="text/html" id="regionTemplate">
    {{#  if(d.region == 0){ }}
        <span>北京</span>
    {{#  } else if(d.region == 1) { }}
        <span>上海</span>
    {{#  } else if(d.region == 2) { }}
        <span>广州</span>
    {{#  } else if(d.region == 3) { }}
        <span>深圳</span>
    {{#  } else if(d.region == 4) { }}
        <span>西安</span>
    {{#  } else { }}
        <span>未知</span>
    {{#  } }}
</script>


<script>

    //console.info("aaaa");
    $(function(){
        $("#detail").hide();
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;

        function goTasks(sign,label) {
                // 项目点击 create
                $("[label='"+label+"']").click(function(){
                    //alert(123);
                    $("#detail").show();
                    $("#project").hide();
                    //$(".layui-tab-content").show();
                    $("#projectId").val($(this).data("id"));
                    //页面赋值
                    $.get('../task/tasks.html',function(data){
                        //alert(321);
                        $("#taskContent").html(data);
                       // alert(sign);
                        if (sign ==0 ) {
                            $("#createTask").hide();
                        }
                    });
                });
                // 返回按钮
                $("#backProjectButton").click(function(){
                    $("#detail").hide();
                    $("#project").show();
                });
        }
        //我加入的
        function shoOwnProjectList() {
            var userId = $("#userId").val();
            $.get('project/getOwnProjectList',{userId:userId},function (data) {
                //layer.msg('成功');
                var html = '';
                var project;
                for (var i = 0; i < data.length;i++){
                    project = data[i];
                    html +='<div class="layui-col-md4">';
                    html +='<div label="join-project" data-id="'+ project.id +'" class="layui-card"  style="background:url(\'../image/'+ project.bgUrl+ '\'); cursor: pointer;">';
                    html +='<div class="layui-card-header">项目'+(i+1)+'</div>';
                    html +='<div class="layui-card-body">'+project.name+'';
                    html +='</div></div></div>';
                }
                $("#MyOwnProjectList").html(html);
                //调用task.html
                goTasks(0,'join-project');
                // //页面赋值
                // $.get('../task/tasks.html',function(data){
                //     //alert(321);
                //     $("#taskContent").html(data);
                // });
            });
        }

        //我创建的
        function showMyProjectList() {
            //console.info("aaa")
            $.get('project/getProjectList',{},function (data){
                //console.info(data);
                var html = '';
                var project;
                for (var i =0 ;i< data.length;i++) {
                     project = data[i];
                     html += ' <div class="layui-col-md4" style="font-weight:bold;">';
                     html += ' <div label="my-project" class="layui-card" data-id="'+ project.id +'" style="background:url(\'../image/' + project.bgUrl+ '\'); cursor: pointer;">';
                     html += ' <div class="layui-card-header">项目'+(i+1)+'</div>';
                     html += ' <div class="layui-card-body">'+project.name+'</div></div>';
                     html += ' <button data-id="'+ project.id +'" data-name="'+ project.name +'" data-url="'+ project.bgUrl +'" data-key="edit"  class="layui-btn layui-btn-primary layui-btn-xs" >编辑</button>';
                     html += ' <button data-id="'+ project.id +'" data-key="delete" class="layui-btn layui-btn-danger layui-btn-xs">删除</button>';
                     html += ' <button data-id="'+ project.id +'" data-key="distribute" class="layui-btn layui-btn-success layui-btn-xs" id="setting">成员设置</button></div>';
                }
                $("#MyProjectList").html(html);

                //调用task.html
                goTasks(1,'my-project');


                $("[data-key='delete']").click(function(){
                    var that = $(this);
                    layer.confirm('确认删除选择数据吗?',{ icon: 0}, function(index) {
                        var id = that.data("id");
                        $.post('project/deleteProject',{projectId:id},function () {
                            layer.msg('删除成功');
                            showMyProjectList();
                            shoOwnProjectList();
                            layer.close(index);
                        });
                    });
                });

                $("[data-key='edit']").click(function(){
                    //layer.msg($("#userId").val());
                    var id = $(this).data("id");
                    var name = $(this).data("name");
                    var bgUrl = $(this).data("url");

                    //alert(id + ',' + name + ',' + bgUrl);


                    $.get('project/form.html',function(html){
                        var index = layer.open({
                            type: 1
                            ,title: '项目信息'
                            ,area: ['700px', '530px']
                            ,shade: 0
                            ,maxmin: true
                            ,content: html
                            ,success:function(){
                            }
                        });
                        onFormLoad();

                        // 表单赋值
                        var form = layui.form;
                        form.val("project-form", {
                            id:id,
                            name:name,
                            bgUrl:bgUrl
                        });
                        $('[tag="img"]').css("border","none");
                        $("[key='"+ bgUrl +"']").css("border","2px solid blue");

                        $("#layerIndex").val(index);
                    });
                });

                $("[data-key='distribute']").click(function () {
                    var projectId = $(this).data("id");
                    $("#formProjectId").val(projectId);

                    $.get('project/userList.html',function(html) {
                        var index = layer.open({
                            type: 1
                            , title: '成员名单'
                            , area: ['450px', '530px']
                            , shade: 0
                            , maxmin: true
                            , content:html
                            , btn:['保存', '取消']
                            , yes: function () {
                                //layer.close(index);
                                var checkStatus = table.checkStatus('taskUserTable'); //idTest 即为基础参数 id 对应的值
                                var data = checkStatus.data;
                                var len = data.length;
                                if(len == 0){
                                    layer.alert('求你选个人吧',{
                                        icon:0
                                    });
                                    return;
                                }
                                var userIdArray = new Array();
                                for (var i = 0; i<data.length;i++){
                                    userIdArray.push(data[i].id);
                                }
                                $.post('project/AddUserTask',{projectId:projectId,userIds:userIdArray},function (data) {
                                    layer.msg('设置成功');
                                    shoOwnProjectList();
                                    layer.close(index);
                                })
                            }
                            , btn2:function () {
                                layer.close(index);
                            }
                            // ,done:function () {
                            //     $.get('project/getUserByProjectId',{projectId:projectId},function (data) {
                            //          var projectJoinArray = new Array();
                            //          for (var i = 0; i < data.length ;i++){
                            //              projectJoinArray.push(data[i].userId);
                            //          }
                            //          console.info(content.toString());
                            //          layer.msg(projectJoinArray);
                            //     });
                            // }
                        });
                    });
                    layui.extend()
                });
            });
        }


        // console.info("shoOwnProjectList");

        showMyProjectList();
        shoOwnProjectList();

        //创建表单提交
        function onFormLoad(){
            $('[tag="img"]').click(function(){
                $('[tag="img"]').css("border","none");
                $(this).css("border","2px solid blue");

                //获取key值
                var bg =  $(this).attr("key");
                $("#bg_url").val(bg);
            });

            //监听提交
            form.on('submit(project-form-submit)', function(data){
                //alert(123);
                $.post('project/addOrUpdateProject',data.field,function (data) {
                    layer.msg('保存成功');
                    var layerIndex = $("#layerIndex").val();
                    if(layerIndex > 0){
                        layer.close(layerIndex);
                    }
                    showMyProjectList();
                },'json');
                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });
        }

        //创建按钮
        $("#createProjectButton").click(function () {
            $.get('project/form.html',function(html){
                var index = layer.open({
                    type: 1
                    ,title: '项目信息'
                    ,area: ['700px', '530px']
                    ,shade: 0
                    ,maxmin: true
                    ,content: html
                    ,success:function(){
                    }
                });

                onFormLoad();
                //showMyProjectList
                $("#layerIndex").val(index);
            });
        });

        // // 项目点击
        // $("[label='my-project']").click(function(){
        //     alert(123);
        //     $("#detail").show();
        //     $(".layui-tab-content").show();
        //     $("#project").hide();
        // });
        //
        // // 返回按钮
        // $("#backProjectButton").click(function(){
        //     $("#detail").hide();
        //     $("#project").show();
        // });
        //
        // //页面赋值
        // $.get('../task/tasks.html',function(data){
        //     alert(321);
        //     $("#taskContent").html(data);
        // });

        //shoOwnProjectList();







        //
        // $("#userDelete").click(function () {
        //     var checkStatus = table.checkStatus('userTable'); //idTest 即为基础参数 id 对应的值
        //     var data = checkStatus.data;
        //     var len = data.length;
        //     if(len == 0){
        //         alert("选中再删，可好？");
        //         return;
        //     }
        //
        //     layer.confirm('确认删除选择数据吗?',{ icon: 0}, function(index) {
        //         var idArray = new Array();
        //         for (var i = 0; i < data.length; i++) {
        //             idArray.push(data[i].id);
        //         }
        //
        //         $.post('user/removeUsers', {ids: idArray}, function (data) {
        //             layer.msg('删除成功');
        //             table.reload('userTable', {
        //                 page: 1
        //             });
        //         })
        //     });
        // });


        // //监听行工具事件
        // table.on('tool(userTable)', function(obj){
        //     var data = obj.data;
        //     //console.log(obj)
        //     if(obj.event === 'del'){
        //         layer.confirm('确认删除选择数据吗?',{ icon: 0}, function(index){
        //             $.post('user/removeUser',{id:data.id},function(data){
        //                 layer.msg('删除成功');
        //                 layer.close(index);
        //                 table.reload('userTable',{
        //                     page:1
        //                 });
        //             })
        //         });
        //
        //
        //     } else if(obj.event === 'edit'){
        //         $.get('user/form.html',function(html){
        //             var index = layer.open({
        //                 type: 1
        //                 ,title: '用户添加'
        //                 ,area: ['700px', '530px']
        //                 ,shade: 0
        //                 ,maxmin: true
        //                 ,content: html
        //                 //,btn: ['保存', '取消']
        //                 ,yes: function(){
        //                     $(that).click();
        //                 }
        //                 ,btn2: function(){
        //                     layer.close(index);
        //                 }
        //             });
        //
        //             $("#layerIndex").val(index);
        //             // 表单赋值
        //             var form = layui.form;
        //             form.val("user-form", data);
        //
        //         });
        //
        //     } else if(obj.event === 'assignRole'){
        //         var tree;
        //         var index = layer.open({
        //             type: 1
        //             ,title: '角色分配'
        //             ,area: ['400px', '300px']
        //             ,shade: 0
        //             ,maxmin: true
        //             ,content: '<ul id="roleTree"></ul>'
        //             ,btn: ['保存', '取消']
        //             ,yes: function(){
        //                 var roles = tree.getChecked(false, true);
        //                 var roleIdArray = new Array();
        //                 for(var i = 0; i< roles.length; i++){
        //                     roleIdArray.push(roles[i].id);
        //                 }
        //                 $.post('user/addRole',{userId:data.id,roleIds:roleIdArray},function(){
        //                     layer.msg('设置成功');
        //                     layer.close(index);
        //                 });
        //             }
        //             ,btn2: function(){
        //                 layer.close(index);
        //             }
        //         });
        //
        //         layui.extend({
        //             eleTree: 'ele-tree/eleTree'
        //         }).use(['eleTree'], function () {
        //             tree = layui.eleTree.render({
        //                 elem: '#roleTree',
        //                 url: 'role/getRoleList',
        //                 showCheckbox: true,
        //                 request: {
        //                     name: "name",
        //                     key: "id",
        //                     children: "children",
        //                     checked: "checked",
        //                     disabled: "disabled",
        //                     isLeaf: "isLeaf"
        //                 },
        //                 response: {
        //                     statusName: "code",
        //                     statusCode: 0,
        //                     dataName: "list"
        //                 },
        //                 done:function(){
        //                     $.get('user/getRoleByUserId?userId=' + data.id,{},function(data){
        //                         var idArray = new Array();
        //                         for(var i = 0 ; i< data.length;i++){
        //                             idArray.push(data[i].roleId);
        //                         }
        //                         tree.setChecked(idArray,true);
        //                     },'json');
        //                 }
        //             });
        //         });
        //     }
        // });

    });
</script>